#defaults
acl localnet src 10.0.0.0/8
acl localnet src 172.16.0.0/12
acl localnet src 192.168.0.0/16
acl localnet src fc00::/7
acl localnet src fe80::/10
acl SSL_ports port 443
acl Safe_ports port 80
acl Safe_ports port 21
acl Safe_ports port 443
acl Safe_ports port 70
acl Safe_ports port 210
acl Safe_ports port 1025-65535
acl Safe_ports port 280
acl Safe_ports port 488
acl Safe_ports port 591
acl Safe_ports port 777
acl CONNECT method CONNECT

http_access allow manager localhost
http_access deny manager
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localnet
http_access allow localhost     # allow traffic from localhost


# to allow other client IP, set them up above
http_access deny all


#
# INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
#
dns_v4_first on


cache_effective_user proxy
cache_effective_group proxy

# this work for both http and https traffic
http_port 3128 ssl-bump \
    generate-host-certificates=on \
    dynamic_cert_mem_cache_size=4MB \
    cert=/usr/local/squid/ca.crt \
    key=/usr/local/squid/ca.key

#https_port [::]:3128 ssl-bump \
#    generate-host-certificates=on \
#    dynamic_cert_mem_cache_size=4MB \
#    cert=/usr/local/squid/ca.crt \
#    key=/usr/local/squid/ca.key

#always_direct allow all
ssl_bump server-first all

#sslproxy_cert_error deny all
sslproxy_flags DONT_VERIFY_PEER

sslcrtd_program /usr/lib/squid/ssl_crtd -s /var/lib/ssl_db -M 4MB
sslcrtd_children 8 startup=1 idle=1

# icap filtering service
icap_enable off
icap_preview_enable off

# request filtering, set bypass to 0 to enforce
icap_service service_req reqmod_precache bypass=1 icap://icap:1344
adaptation_access service_req allow all

# response filtering, set bypass to 0 to enforce
icap_service service_resp respmod_precache bypass=1 icap://icap:1344
adaptation_access service_resp allow all

#
# Add any of your own refresh_pattern entries above these.
#
refresh_pattern ^ftp:       1440    20% 10080
refresh_pattern ^gopher:    1440    0%  1440
refresh_pattern -i (/cgi-bin/|\?) 0 0%  0
refresh_pattern .       0   20% 4320

shutdown_lifetime 1 second
